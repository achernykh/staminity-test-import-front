<div flex layout="column">
    <!-- Заголовок тренировки (верхняя часть): начало -->
    <div flex layout="column"
         class="activity-header {{::$ctrl.status}}"
         ng-class="{selected: $ctrl.selected}"
         ng-click="$ctrl.show($env)">
        <div layout="row" layout-align="space-between center">
            <div flex="25" class="md-caption tight-07">{{::$ctrl.data.statusPercent}}{{!!$ctrl.data.statusPercent ? '%'
                : ''}}</div>

            <div flex="none" layout="row" layout-align="center center" class="bg-circle-32 bg-blue-grey-A700">
                <md-icon md-svg-src="assets/icon/{{::$ctrl.item.activityHeader.activityType.code}}.svg"
                         style="margin-left: 4px"
                         class="s24 light-active"></md-icon>
                <md-icon ng-if="$ctrl.structured"
                         md-svg-src="assets/icon/{{::$ctrl.intensityMeasure}}.svg"
                         style="margin-left: 2px; margin-right: 2px"
                         class="s18 light-active"></md-icon>
                <div ng-if="$ctrl.structured"
                     style="margin-right: 8px; margin-left: -3px; margin-bottom: -14px; font-size: 12px;">
                    {{::$ctrl.intensityFtpMax}}
                </div>
            </div>

            <div flex="25">
                <md-menu style="margin-right: -12px">
                    <md-button class="md-icon-button" aria-label="More Event"
                               style="margin-right: 0px"
                               ng-click="$mdOpenMenu($event)">
                        <md-icon id="more" md-svg-src="assets/icon/more_vert.svg"
                                 class="s18"></md-icon>
                    </md-button>
                    <md-menu-content>
                        <md-menu-item><md-button>Открыть</md-button></md-menu-item>
                        <md-menu-item><md-button disabled="disabled">Выделить</md-button></md-menu-item>
                        <md-menu-item><md-button>Скопировать</md-button></md-menu-item>
                        <md-menu-item><md-button ng-click="$ctrl.onDelete()">Удалить</md-button></md-menu-item>
                    </md-menu-content>
                </md-menu>
            </div>
        </div>
        <div flex layout="row" layout-align="center center"
             class="md-caption secondary center"
             ng-class="{'dark' : ($ctrl.status == 'planned')}"
             style="margin-top: 8px;">
            <div flex="none" class="line-14">{{::$ctrl.item.activityHeader.activityCategory.code}}</div>
        </div>
        <div flex layout="row" layout-align="center center"
             class="md-title small secondary center tight-10"
             ng-class="{'dark' : ($ctrl.status == 'planned')}"
             style=""
             ng-if="!!$ctrl.data.duration || $ctrl.data.distance">
            <div flex="none">{{::$ctrl.data.duration}}</div>
            <div flex="none"><span>&nbsp;&nbsp;&nbsp</span></div>
            <div flex="none">{{::$ctrl.data.distance}}</div>
        </div>
    </div>
    <!-- Заголовок тренировки (верхняя часть): начало -->
    <div flex layout="column"
         hide show-gt-md
         class="activity-footer line-12"
         ng-switch on="::$ctrl.bottomPanel"
         ng-if="!$ctrl.calendar.view.compact && !!$ctrl.bottomPanel">
        <!-- Панель: Установка тренера -->
        <div ng-switch-when="prescription"
             flex class="md-caption"
             ng-if="!!$ctrl.trainersPrescription"
             hm-read-more
             hm-text="{{::$ctrl.trainersPrescription}}"
             hm-limit="50"
             hm-more-text="more"
             hm-less-text="less"
             hm-dots-class="read-more-dots"
             hm-link-class="read-more-links">
        </div>
        <!-- Панель: Фактические данные по неструктурированной тренировке -->
        <div ng-switch-when="data"
             flex layout="row"
             class="md-caption">
            <div flex="none">
                <md-icon md-svg-src="assets/icon/watch.svg"
                         class="s18 dark-active"
                         style="margin-right: 8px"></md-icon>
            </div>
            <div flex layout="column"
                 class="md-caption secondary dark"
                 style="margin-top: 2px">
                <div flex>{{::$ctrl.data.speedAvg}}<span class="disable dark"> мин/км</span></div>
                <div flex>{{::$ctrl.data.heartRateAvg}}<span class="disable dark"> чсс</span></div>
                <div flex>{{::$ctrl.data.powerAvg}}<span class="disable dark"> ватт</span></div>
            </div>
        </div>
        <!-- Панель: Перечень сегментов структурированной тренировки -->
        <div ng-switch-when="segmentList"
             flex layout="column"
             class="md-caption">
            <div ng-repeat="interval in $ctrl.segmentList"
                 ng-switch on="::interval.group"
                 flex layout="row">
                <!-- группа интервалов -->
                <div ng-switch-when="true"
                     ng-if="interval.show || $ctrl.collapse"
                     flex layout="row" layout-align="start center">
                    <div flex="none" style="width: 20px" class="md-body-2">{{::interval.repeatCount}}x</div>
                    <div flex="auto" layout="column">
                        <div ng-repeat="item in interval.subItem"
                             ng-if="item.show || $ctrl.collapse"
                             flex layout="row"
                             class="segment-list"
                             ng-class="{'newlinesvg': interval.keyInterval}">
                            <div flex="none" style="height: 15px; margin-right: 4px">
                                <img src="{{::$ctrl.getBullet($first, $middle, $last)}}"
                                         style="width: 15px; height: 15px; min-width: 15px; min-height: 15px"
                                         class="dark-active"/>
                            </div>
                            <div flex="none" style="width: 40px">{{::item.calcMeasures.distance.value}} км</div>
                            <div flex="auto">{{::item.calcMeasures.heartRate.value}}чсс</div>
                        </div>
                    </div>
                </div>
                <!-- отдельный сегмент -->
                <div ng-switch-when="false"
                     ng-if="interval.show || $ctrl.collapse"
                     flex layout="row">
                    <div flex="none" style="width: 20px"></div>
                    <div flex layout="row"
                         class="segment-list"
                         ng-class="{'newlinesvg': interval.keyInterval}">
                        <div flex="none" style="height: 15px; margin-right: 4px">
                            <img src="assets/icon/bullet.svg"
                                     style="width: 15px; height: 15px; min-width: 15px; min-height: 15px"
                                     class="dark-active"/></div>
                        <div flex="none" style="width: 40px">{{::interval.calcMeasures.distance.value}} км</div>
                        <div flex="auto">{{::interval.calcMeasures.heartRate.value}}чсс</div>
                    </div>
                </div>
            </div>

        </div>
        <div ng-if="$ctrl.segmentList.length > 4"
             flex layout="row" layout-align="center start"
             class="md-caption bt-more"
             ng-click="$ctrl.collapse = !$ctrl.collapse">
            <div>{{!$ctrl.collapse ? '...more' : '...less'}}</div>
        </div>
    </div>
</div>

