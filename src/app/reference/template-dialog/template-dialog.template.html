<md-dialog style="height: 95vh; max-width: 380px; min-width: 360px;">
	<form name="$ctrl.form" ng-submit="$ctrl.submit[$ctrl.mode] ()" style="height: 100%">
		<md-dialog-content flex layout="column">
			<md-toolbar flex="none">
				<div class="md-toolbar-tools" ng-cloak>
					<md-menu md-position-mode="target-right target" md-offset="0 60" md-position-mode="target-right target">
						<md-button class="md-icon-button" ng-click="$mdOpenMenu($event)">
							<md-icon class="material-icons">menu</md-icon>
						</md-button>
						<md-menu-content width="4">
							<md-menu-item>
								<md-button ng-click="$ctrl.delete()" ng-disabled="$ctrl.mode !== 'edit'">
								<md-icon class="material-icons" md-menu-align-target>delete</md-icon>
									<span translate="measurement.toolbar.delete"></span>
								</md-button>
							</md-menu-item>
						</md-menu-content>
					</md-menu>
					<h2>{{ 'reference.templates.singular' | translate }}</h2>
					<span flex></span>
					<userpic class="border-light" profile="$ctrl.user" is-premium="$ctrl.user.isPremium" unlink="true"></userpic>
					<md-button class="md-icon-button" hide-gt-sm ng-click="$ctrl.close()">
						<md-tooltip md-direction="left">{{ 'measurement.toolbar.close' | translate }}</md-tooltip>
						<md-icon class="material-icons" aria-label="Close dialog">close</md-icon>
					</md-button>
				</div>
			</md-toolbar>

			<md-content flex="auto" layout="column">
				<md-tabs flex="auto" layout-fill class="md-primary md-hue-2" 
					md-selected="$ctrl.selectedTab"
					md-stretch-tabs="always" ng-cloak
				>
					<md-tab id="overview" flex="auto" layout="column">
						<md-tab-label><md-icon class="material-icons">event_note</md-icon></md-tab-label>
						<md-tab-body layout="column" layout-fill>
							
							<md-list class="md-dense slim-input bg-grey-200">
								<md-list-item>
									<md-input-container class="md-block no-message" md-no-float layout="row">
										<md-icon flex="none" md-svg-src="assets/icon/{{ $ctrl.activityType.code }}.svg"></md-icon>
										<md-select flex name="sport" class="icon" required
											ng-model="$ctrl.activityType"
											ng-disabled="$ctrl.mode === 'view'"
										>
											<md-option 
												ng-repeat="activityType in $ctrl.activityTypes"
												ng-value="activityType"
											>{{ 'sport.' + activityType.code | translate }}</md-option>
										</md-select>
										<div ng-messages="$ctrl.form.sport.$error" role="alert">
											<div ng-message-exp="['required']" translate="form.required"></div>
											<div ng-message-exp="['minlength', 'maxlength']" translate="form.rangeStr" translate-values="{min:2, max:100}"></div>
										</div>
									</md-input-container>
								</md-list-item>
								<md-list-item>
									<md-input-container class="md-block no-message" md-no-float>
										<md-icon class="material-icons" ng-click="$ctrl.link('https://help.staminity.com/ru/basics/activity-categories.html')" style="cursor: pointer">tune</md-icon>
										<md-select 
											ng-model="$ctrl.activityTemplate.activityCategory" required
											ng-model-options="{ trackBy: '$value.id' }"
											placeholder="{{ 'reference.templates.cathegory' | translate }}"
											ng-disabled="$ctrl.mode === 'view'"
											name="category" class="icon"
										>
											<md-option 
												ng-repeat="cathegory in $ctrl.cathegoriesByActivityType" 
												ng-value="cathegory"
											>{{ cathegory | cathegoryCode }}</md-option>
										</md-select>
										<div ng-messages="$ctrl.form.cathegory.$error" role="alert">
											<div ng-message="required" translate="form.required"></div>
										</div>
									</md-input-container>
								</md-list-item>
								<md-list-item>
									<md-input-container class="md-block">
										<md-icon class="material-icons">mode_edit</md-icon>
										<input 
											placeholder="{{ 'reference.templates.name' | translate }}" 
											ng-model="$ctrl.activityTemplate.code"
											ng-disabled="$ctrl.mode === 'view'"
											required
										/>
									</md-input-container>
								</md-list-item>
								<md-list-item>
									<md-input-container class="md-block">
										<md-icon class="material-icons"></md-icon>
										<input 
											placeholder="{{ 'reference.templates.description' | translate }}" 
											ng-model="$ctrl.activityTemplate.description"
											ng-disabled="$ctrl.mode === 'view'"
											required
										/>
									</md-input-container>
								</md-list-item>
								<md-list-item>
									<md-input-container class="md-block no-message font-13" md-no-float>
										{{ 'reference.templates.favourite' | translate }}
										<md-switch 
											class="md-secondary md-primary"
											ng-model="$ctrl.activityTemplate.favourite"
										></md-switch>
									</md-input-container>
								</md-list-item>
							</md-list>

							<div ng-repeat="interval in $ctrl.activityTemplate.content">
								<template-interval-pw 
									ng-if="interval.type === 'pW'" 
									interval="interval" 
									activity-type="$ctrl.activityType"
									user="$ctrl.user"
									mode="$ctrl.mode"
								></template-interval-pw>
							</div>

							<div flex="auto" class="bg-grey-100"></div>

						</md-tab-body>
					</md-tab>
				</md-tabs>
			</md-content>
		</md-dialog-content>

		<md-dialog-actions flex="none" layout="row" style="background: white">
			<span flex></span>
			<md-button 
				ng-if="$ctrl.mode !== 'view'" 
				ng-click="$ctrl.close()"
			>{{ 'form.cancel' | translate }}</md-button>
			<md-button 
				type="submit"
				ng-if="$ctrl.item.mode !== 'view'"
				ng-disabled="!$ctrl.form.$dirty || !$ctrl.form.$valid"
			>{{ 'form.save' | translate }}</md-button>
		</md-dialog-actions>
	</form>
</md-dialog>